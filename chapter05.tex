\chapter{Тестирование и анализ результатов}

В данном разделе проводится исследование характеристик прототипа на примере его использования для обнаружения клонов. Тестирование проводилось на нескольких различных выборках из BigCloneBench.

\section{Описание тестовых данных}

Для тестирования разработанного прототипа из выборки BigCloneBench были выделены партии с разным количеством методов:

\begin{itemize}
\setlength\itemsep{0mm}
\item приблизительно 4000 методов
\item приблизительно 4000 методов
\item приблизительно 10000 методов
\item приблизительно 20000 методов
\end{itemize}

Выбранные фрагменты набора можно считать как программами среднего, так и программами большого размера. Так как в выборке BigCloneBench присутствуют различные файлы, классы и методы из различных проектов, то случайно выбранные методы, вероятнее всего, друг с другом никак не связаны.

\section{Описание тестовой платформы и конфигурации прототипа}

Все эксперименты в рамках данного тестирования были проведены на двух различных машинах со следующими конфигурациями:

\begin{enumerate}
\setlength\itemsep{0mm}
\item ПК
\begin{itemize}
\setlength\itemsep{0mm}
\item ОС ArchLinux;
\item CPU Intel(R) Core(TM) i7-7700K CPU 4.20ГГц;
\item 64 Гб RAM;
\item NVidia Quadro P4000 8Гб;
\end{itemize}
\item DGX-1
\begin{itemize}
\setlength\itemsep{0mm}
\item ОС Ubuntu 16.04 LTS
\item Intel(R) Xeon(R) CPU E5-2698 v4 2.20 ГГц x2;
\item 512 ГГб RAM
\item NVidia Tesla V100 16Гб x8.
\end{itemize}
\end{enumerate}

\section{Схема работы прототипа}

Общая схема работы прототипа в тестовом режиме выглядит следующим образом:

\begin{itemize}
\setlength\itemsep{0mm}
\item Случайным образом выбираются пары клонов и не клонов из таблиц BigCloneBench;
\item Производится анализ файлов соответствующих данной выборке;
\item Для проанализированных файлов строится PSI;
\item Полученные PSI преобразуются в последовательности интересующих нас токенов;
\item Для построенных токенов строятся их векторные преобразования с помощью word2vec;
\item С помощью seq2seq полученные преобразования приводятся к единой размерности;
\item Результат работы seq2seq передается в Сиамскую сеть, в которой производится сравнение пар;
\item На основе результата Сиамской сети считаются метрики для анализа работы прототипа.
\end{itemize}

\section{Исследование показателей прототипа}

Главной задачей данной работы является разработка метода интеллектуального обнаружения клонов. Основными требованиями, предъявляемыми к такому методу, являются увеличение точности поиска и определение клонов первых трех типов. Данные характеристики исследуются на примере использования разработанного прототипа для обнаружения клонов. Результат анализа прототипа представлен в таблице \ref{testing}, где:

\begin{itemize}
\setlength\itemsep{0mm}
\item \(KLOC\) - количество строк исходного кода (в тысячах);
\item \(N_{methods}\) - количество исследуемых методов;
\item \(N_{clones}\) - количество найденных клонов;
\item \(Rec\) - полнота результата;
\item \(Prec\) - точность результата;
\item \(F_1\) - гармоническое среднее значение полноты и точности;
\item \(t_f\) - полное время работы (без учета обучения сетей).
\end{itemize}

\begin{table}[H]
\centering
\captionsetup{skip=5pt}
\caption{Результаты тестирования}
\label{testing}
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline
\(N_{methods}\) & \(KLOC\) & \(N_{clones}\) & \(Rec\)  & \(Prec\) & \(F_1\) & \(t_f\)        \\ \hline
\multicolumn{7}{|c|}{ПК}										   		    			   \\ \hline
4092			& 228	   & 1697			& 0.94	   & 0.97 	  & 0.95 	& 04:42 мин	   \\ \hline
8270			& 768  	   & 5453    		& 0.88 	   & 0.94 	  & 0.91 	& 06:55 мин	   \\ \hline
10892			& 3192 	   & 32041   		& 0.88 	   & 0.93 	  & 0.90 	& 09:44 мин 	   \\ \hline
19711    		& 2830 	   & 24797   		& 0.90 	   & 0.76 	  & 0.82 	& 14:43 мин 	   \\ \hline
\multicolumn{7}{|c|}{DGX}										   		      		   \\ \hline
4121			& 231	   & 2314    		& 0.92 	   & 0.95 	  & 0.93 	& 03:20 мин 	   \\ \hline
8321     		& 754  	   & 5325    		& 0.89 	   & 0.97 	  & 0.93 	& 04:34 мин 	   \\ \hline
10523    		& 3152 	   & 26395   		& 0.88 	   & 0.94 	  & 0.91 	& 07:55 мин 	   \\ \hline
18753    		& 2965 	   & 35486   		& 0.90 	   & 0.79 	  & 0.84 	& 11:32 мин 	   \\ \hline
\end{tabular}
\end{table}

Все анализируемые метрики весьма тривиальные, за исключением \(Recall\), \(Precision\) и \(F_1\). Для их пояснения необходимо ввести некоторые понятия, а именно - \(True\ positives\ (TP)\), \(True\ negatives\ (TN)\), \(False\ positives\ (FP)\), \(False\ negatives\ (FN)\), где:

\begin{itemize}
\setlength\itemsep{0mm}
\item \(True\ positives\) - истинно-положительный результат;
\item \(True\ negatives\) -  истинно-отрицательный результат;
\item \(False\ positives\) - ложно-положительные результаты;
\item \(False\ negatives\) - ложно-отрицательные результаты.
\end{itemize}

Такие метрики рассчитываются согласно табл. \ref{truepos}, где CD - ответ выданный прототипом (Clone Detector).

\begin{table}[H]
\centering
\captionsetup{skip=5pt}
\caption{Вспомогательные метрики}
\label{truepos}
\begin{tabular}{c|c|c|}
\cline{2-3}
                                   & Клон & Не клон \\ \hline
\multicolumn{1}{|c|}{Клон (CD)}    & TP   & FP      \\ \hline
\multicolumn{1}{|c|}{Не клон (CD)} & FN   & TN      \\ \hline
\end{tabular}
\end{table}

Итак, после введения дополнительных метрик, рассчет \(Precision\), \(Recall\) и \(F_1\) будет намного нагляднее. Для расчета основных метрик оценки работы нейронных сетей используются следующие формулы:

\begin{equation}
\label{eq:recall}
Recall = \frac{True\ positives}{True\ positives + False\ negatives}
\end{equation}

\begin{equation}
\label{eq:precision}
Precision = \frac{True\ positives}{True\ positives + False\ positives}
\end{equation}

\begin{equation}
\label{eq:f1}
F_1 = 2*\frac{Precision * Recall}{Precision + Recall}
\end{equation}

\section{Результаты тестирования}

Главными характеристиками, которые анализировались при тестировании прототипа являются точность (\(Precision\)), полнота (\(Recall\)) и их гармоническое среднее значение \(F_1\). Однако, основное внимание необходимо уделить метрике \(F_1\), которая уравновешивает значения полноты и точности. Таким образом, чем больше значение (\(F_1\)) - тем лучше работает разработанный прототип.

Проанализировав результаты в таблице \ref{testing}, можно заметить следующее:
\begin{itemize}
\setlength\itemsep{0mm}
\item С увеличением размера проекта увеличивается время, затрачиваемое на анализ;
\item С увеличением размера проекта незначительно снижается качество работы прототипа.
\end{itemize}

Затрачиваемое время на анализ напрямую зависит от объема методов в анализируемой выборке. Связано это с последовательной обработкой методов и отсутствии вычислительной оптимизации.

«Проседание» точности вычисления при увеличении анализируемых данных допустимо, т.к. оно не является критичным.
